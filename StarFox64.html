<!DOCTYPE html>
<html lang="en">

<!-- Ultimate Game Stash file -->
<!-- For the regularly updating doc go to https://docs.google.com/document/d/1_FmH3BlSBQI7FGgAQL59-ZPe8eCxs35wel6JUyVaG8Q/ -->

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script>
    window.gameconfig = {
      name: "Star Fox 64 (USA) (Rev 1)",
      url: "https://raw.githubusercontent.com/marlwolf606-dev/N64GameRoms/main/Starfox64/Star%20Fox%2064%20(USA)%20(Rev%201).z64",
      core: "n64",
      min: 1,
      max: 1
    };
  </script>

  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      background-color: #121212;
      color: white;
      font-family: Arial, sans-serif;
    }

    #game-container {
      text-align: center;
      width: 100%;
      height: 100%;
    }

    #loading-progress {
      font-size: 18px;
      margin-top: 20px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      display: inline-block;
    }
  </style>
</head>

<body>
  <div id="game-container">
    <div id="game"></div>
    <div id="loading-progress">Loading game...</div>
    <div id="first-time">First-time loading may take longer...</div>
  </div>

  <script>
    Promise.resolve(window.gameconfig.url)
      .then((gameUrl) => {
        document.getElementById("loading-progress").remove();
        document.getElementById("first-time").remove();

        /* ===== EmulatorJS config ===== */
        EJS_player = "#game";
        EJS_core = window.gameconfig.core;
        EJS_gameName = window.gameconfig.name;
        EJS_gameUrl = gameUrl;
        EJS_pathtodata = "https://cdn.jsdelivr.net/gh/genizy/emu@master/";
        EJS_startOnLoaded = true;

        /* ===== Video fix (no flashing) ===== */
        EJS_disableWebGL = true;

        /* ===== Stability fixes ===== */
        EJS_threads = false;       // prevent desync freezes
        EJS_forceExtract = true;   // prevent GC pauses

        document.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "visible") {
            try { if (typeof EJS_audioContext !== "undefined") EJS_audioContext.resume(); } catch (e) {}
          }
        });

        document.addEventListener("blur", () => {
          try { if (typeof EJS_audioContext !== "undefined") EJS_audioContext.resume(); } catch (e) {}
        });

        /* ===== Optional long-run fixes ===== */
        EJS_pollRate = 60;         // stabilize emulation loop
        EJS_fps = 60;              // fixed 60fps timing
        EJS_backgroundMode = "active"; // prevent Chrome throttling
        EJS_pauseOnBlur = false;
        EJS_pauseOnFocusLost = false;
        EJS_dynamicSpeed = false;  // avoid CPU clock drift

        /* Load EmulatorJS */
        const script = document.createElement("script");
        script.src = "https://cdn.jsdelivr.net/gh/genizy/emu@master/loader.js";
        document.body.appendChild(script);
      })
      .catch((error) => {
        console.error(error);
        document.getElementById("loading-progress").textContent =
          "Error loading game.";
      });
  </script>
</body>
</html>
